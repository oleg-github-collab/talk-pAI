<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Talk pAI - Advanced Messenger</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f0f2f5;
            height: 100vh;
            overflow: hidden;
        }

        .messenger-container {
            display: flex;
            height: 100vh;
            width: 100%;
        }

        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            width: 400px;
            text-align: center;
        }

        .login-box h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 24px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .login-btn {
            width: 100%;
            padding: 12px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 10px;
            transition: background 0.3s;
        }

        .login-btn:hover {
            background: #5a6fd8;
        }

        /* Sidebar */
        .sidebar {
            width: 350px;
            background: white;
            border-right: 1px solid #e4e6ea;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid #e4e6ea;
            background: #667eea;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-info {
            display: flex;
            align-items: center;
            cursor: pointer;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            color: #667eea;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }

        .user-details h3 {
            font-size: 16px;
            margin-bottom: 2px;
        }

        .user-details .status {
            font-size: 12px;
            opacity: 0.8;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .header-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background 0.3s;
        }

        .header-btn:hover {
            background: rgba(255,255,255,0.1);
        }

        /* Search */
        .search-container {
            padding: 15px;
            border-bottom: 1px solid #e4e6ea;
        }

        .search-box {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 40px 12px 40px;
            border: 1px solid #e4e6ea;
            border-radius: 20px;
            background: #f0f2f5;
            font-size: 14px;
            outline: none;
        }

        .search-input:focus {
            background: white;
            border-color: #667eea;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #65676b;
        }

        /* Chat List */
        .chat-list {
            flex: 1;
            overflow-y: auto;
        }

        .chat-item {
            padding: 12px 20px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            position: relative;
        }

        .chat-item:hover {
            background: #f0f2f5;
        }

        .chat-item.active {
            background: #e7f3ff;
            border-right: 3px solid #667eea;
        }

        .chat-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
            font-size: 18px;
        }

        .ai-assistant-avatar {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        .chat-info {
            flex: 1;
            min-width: 0;
        }

        .chat-name {
            font-weight: 600;
            color: #050505;
            margin-bottom: 2px;
            font-size: 14px;
        }

        .chat-preview {
            color: #65676b;
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chat-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
        }

        .chat-time {
            color: #65676b;
            font-size: 12px;
        }

        .chat-badge {
            background: #667eea;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: bold;
        }

        .chat-menu-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            opacity: 0;
            transition: all 0.2s;
        }

        .chat-item:hover .chat-menu-btn {
            opacity: 1;
            background: #f0f2f5;
        }

        .chat-menu-btn:hover {
            background: #e4e6ea !important;
        }

        /* Chat Area */
        .chat-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: white;
        }

        .chat-header {
            padding: 20px;
            border-bottom: 1px solid #e4e6ea;
            background: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .chat-header-info {
            display: flex;
            align-items: center;
        }

        .chat-header-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
        }

        .chat-header-details h3 {
            font-size: 18px;
            color: #050505;
            margin-bottom: 2px;
        }

        .chat-status {
            color: #42b883;
            font-size: 13px;
        }

        .chat-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            background: none;
            border: none;
            padding: 10px;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.2s;
            color: #65676b;
        }

        .action-btn:hover {
            background: #f0f2f5;
        }

        /* Messages */
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: #f0f2f5;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-end;
        }

        .message.sent {
            justify-content: flex-end;
        }

        .message-content {
            max-width: 70%;
            background: white;
            padding: 12px 16px;
            border-radius: 18px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            position: relative;
        }

        .message.sent .message-content {
            background: #667eea;
            color: white;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 8px;
            font-size: 12px;
        }

        .message.sent .message-avatar {
            order: 2;
            margin-right: 0;
            margin-left: 8px;
        }

        .message-text {
            font-size: 14px;
            line-height: 1.4;
            white-space: pre-wrap;
        }

        .message-time {
            font-size: 11px;
            opacity: 0.7;
            margin-top: 4px;
        }

        /* Input Area */
        .input-area {
            padding: 20px;
            background: white;
            border-top: 1px solid #e4e6ea;
        }

        .input-container {
            display: flex;
            align-items: flex-end;
            gap: 10px;
            background: #f0f2f5;
            border-radius: 25px;
            padding: 8px;
        }

        .input-actions {
            display: flex;
            gap: 5px;
        }

        .input-btn {
            background: none;
            border: none;
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            color: #667eea;
            transition: background 0.2s;
        }

        .input-btn:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .message-input {
            flex: 1;
            border: none;
            outline: none;
            background: none;
            padding: 8px 12px;
            font-size: 14px;
            resize: none;
            max-height: 100px;
            min-height: 20px;
        }

        .send-btn {
            background: #667eea;
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s;
        }

        .send-btn:hover {
            background: #5a6fd8;
        }

        .send-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* Dropdown Menus */
        .dropdown-menu {
            position: absolute;
            background: white;
            border: 1px solid #e4e6ea;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            min-width: 200px;
            padding: 8px 0;
            display: none;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .dropdown-item:hover {
            background: #f0f2f5;
        }

        .dropdown-item.danger {
            color: #e74c3c;
        }

        .dropdown-item.danger:hover {
            background: #fdf2f2;
        }

        /* Chat Menu Dropdown */
        .chat-menu {
            position: absolute;
            right: 10px;
            top: 100%;
            background: white;
            border: 1px solid #e4e6ea;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            min-width: 180px;
            padding: 8px 0;
            display: none;
        }

        .chat-menu.show {
            display: block;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e4e6ea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #65676b;
        }

        .modal-body {
            padding: 20px;
        }

        /* Profile Settings */
        .profile-section {
            margin-bottom: 30px;
        }

        .profile-section h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #333;
        }

        .profile-avatar-section {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
        }

        .profile-avatar-large {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 24px;
        }

        .avatar-upload {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .avatar-upload-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-field {
            flex: 1;
        }

        .form-field label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .form-field input,
        .form-field textarea,
        .form-field select {
            width: 100%;
            padding: 10px;
            border: 1px solid #e4e6ea;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-field textarea {
            resize: vertical;
            min-height: 80px;
        }

        .color-picker {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: border-color 0.2s;
        }

        .color-option.selected {
            border-color: #333;
        }

        .theme-options {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .theme-option {
            padding: 10px 15px;
            border: 2px solid #e4e6ea;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s;
        }

        .theme-option.selected {
            border-color: #667eea;
            background: #f0f2ff;
        }

        .privacy-setting {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .privacy-setting:last-child {
            border-bottom: none;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 24px;
            background: #e4e6ea;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: #667eea;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(26px);
        }

        /* File Upload */
        .file-upload-area {
            border: 2px dashed #e4e6ea;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .file-upload-area:hover {
            border-color: #667eea;
        }

        .file-upload-area.dragover {
            border-color: #667eea;
            background: #f0f2ff;
        }

        /* Voice Message */
        .voice-recording {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #fff3cd;
            border-radius: 20px;
            margin: 10px 0;
        }

        .voice-wave {
            display: flex;
            gap: 2px;
            align-items: center;
        }

        .voice-wave span {
            width: 3px;
            height: 20px;
            background: #667eea;
            border-radius: 2px;
            animation: voice-wave 1s infinite ease-in-out;
        }

        .voice-wave span:nth-child(2) { animation-delay: 0.1s; }
        .voice-wave span:nth-child(3) { animation-delay: 0.2s; }
        .voice-wave span:nth-child(4) { animation-delay: 0.3s; }

        @keyframes voice-wave {
            0%, 40%, 100% { transform: scaleY(0.4); }
            20% { transform: scaleY(1); }
        }

        /* Loading States */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Welcome Modal */
        .welcome-modal .modal-content {
            max-width: 600px;
        }

        .welcome-step {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .welcome-step.active {
            display: block;
        }

        .welcome-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }

        .step-indicators {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .step-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #e4e6ea;
            transition: background 0.3s;
        }

        .step-indicator.active {
            background: #667eea;
        }

        .modal-actions {
            display: flex;
            justify-content: space-between;
            padding: 20px;
            border-top: 1px solid #e4e6ea;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: absolute;
                left: -100%;
                transition: left 0.3s;
                z-index: 100;
            }

            .sidebar.open {
                left: 0;
            }

            .chat-area {
                width: 100%;
            }

            .modal-content {
                width: 95%;
                margin: 20px;
            }
        }

        /* Utility Classes */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
        }

        .btn-secondary {
            background: #e4e6ea;
            color: #333;
        }

        .btn-secondary:hover {
            background: #d1d3d7;
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-box">
            <h1>Talk pAI</h1>
            <p style="margin-bottom: 30px; color: #666;">Advanced Messaging Platform</p>

            <div id="loginForm">
                <div class="form-group">
                    <label for="loginNickname">Nickname</label>
                    <input type="text" id="loginNickname" placeholder="Enter your nickname">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password">
                </div>
                <button class="login-btn" onclick="login()">Login</button>
                <button class="login-btn btn-secondary" onclick="showRegister()">Register</button>
            </div>

            <div id="registerForm" style="display: none;">
                <div class="form-group">
                    <label for="registerNickname">Nickname</label>
                    <input type="text" id="registerNickname" placeholder="Choose a nickname">
                </div>
                <div class="form-group">
                    <label for="registerPassword">Password</label>
                    <input type="password" id="registerPassword" placeholder="Choose a password">
                </div>
                <button class="login-btn" onclick="register()">Register</button>
                <button class="login-btn btn-secondary" onclick="showLogin()">Back to Login</button>
            </div>
        </div>
    </div>

    <!-- Main Messenger Interface -->
    <div id="messengerContainer" class="messenger-container" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Sidebar Header -->
            <div class="sidebar-header">
                <div class="user-info" onclick="openProfileSettings()">
                    <div class="user-avatar" id="userAvatar">U</div>
                    <div class="user-details">
                        <h3 id="userName">User</h3>
                        <div class="status">Online</div>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="header-btn" onclick="openSettings()" title="Settings">‚öôÔ∏è</button>
                    <button class="header-btn" onclick="logout()" title="Logout">üö™</button>
                </div>
            </div>

            <!-- Search -->
            <div class="search-container">
                <div class="search-box">
                    <input type="text" class="search-input" placeholder="Search conversations..." id="searchInput">
                    <span class="search-icon">üîç</span>
                </div>
            </div>

            <!-- Chat List -->
            <div class="chat-list" id="chatList">
                <!-- AI Assistant as separate contact -->
                <div class="chat-item" data-chat-id="ai-assistant" onclick="selectChat('ai-assistant')">
                    <div class="chat-avatar ai-assistant-avatar">ü§ñ</div>
                    <div class="chat-info">
                        <div class="chat-name">AI Assistant</div>
                        <div class="chat-preview">Advanced AI helper with multiple capabilities</div>
                    </div>
                    <div class="chat-meta">
                        <div class="chat-time">Now</div>
                        <div class="chat-badge" style="background: linear-gradient(135deg, #667eea, #764ba2);">AI</div>
                    </div>
                    <button class="chat-menu-btn" onclick="toggleChatMenu(event, 'ai-assistant')">‚ãÆ</button>
                </div>
            </div>
        </div>

        <!-- Chat Area -->
        <div class="chat-area">
            <!-- Chat Header -->
            <div class="chat-header">
                <div class="chat-header-info">
                    <div class="chat-header-avatar" id="chatHeaderAvatar">üí¨</div>
                    <div class="chat-header-details">
                        <h3 id="chatHeaderName">Select a conversation</h3>
                        <div class="chat-status" id="chatHeaderStatus">Choose a chat to start messaging</div>
                    </div>
                </div>
                <div class="chat-actions">
                    <button class="action-btn" onclick="startVoiceCall()" title="Voice Call">üìû</button>
                    <button class="action-btn" onclick="startVideoCall()" title="Video Call">üìπ</button>
                    <button class="action-btn" onclick="openChatInfo()" title="Chat Info">‚ÑπÔ∏è</button>
                    <button class="action-btn" onclick="toggleChatOptions()" title="More Options">‚ãÆ</button>
                </div>
            </div>

            <!-- Messages -->
            <div class="messages-container" id="messagesContainer">
                <div class="text-center" style="padding: 40px; color: #65676b;">
                    <div style="font-size: 48px; margin-bottom: 20px;">üí¨</div>
                    <h3>Welcome to Talk pAI</h3>
                    <p>Select a conversation or start chatting with the AI Assistant</p>
                </div>
            </div>

            <!-- Input Area -->
            <div class="input-area">
                <div class="input-container">
                    <div class="input-actions">
                        <button class="input-btn" onclick="toggleEmojiPicker()" title="Emoji">üòä</button>
                        <button class="input-btn" onclick="openFileUpload()" title="Attach File">üìé</button>
                        <button class="input-btn" onclick="toggleVoiceRecording()" title="Voice Message">üé§</button>
                        <button class="input-btn" onclick="openImageGenerator()" title="Generate Image">üé®</button>
                        <button class="input-btn" onclick="openSpreadsheetGenerator()" title="Create Spreadsheet">üìä</button>
                    </div>
                    <textarea class="message-input" id="messageInput" placeholder="Type a message..." rows="1"></textarea>
                    <button class="send-btn" id="sendBtn" onclick="sendMessage()" disabled>
                        <span>‚û§</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Menu Dropdown -->
    <div id="chatMenu" class="chat-menu">
        <div class="dropdown-item" onclick="pinChat()">
            <span>üìå</span> Pin Chat
        </div>
        <div class="dropdown-item" onclick="muteChat()">
            <span>üîá</span> Mute Notifications
        </div>
        <div class="dropdown-item" onclick="archiveChat()">
            <span>üì¶</span> Archive Chat
        </div>
        <div class="dropdown-item" onclick="markAsUnread()">
            <span>üìß</span> Mark as Unread
        </div>
        <div class="dropdown-item" onclick="exportChat()">
            <span>üíæ</span> Export Chat
        </div>
        <div class="dropdown-item danger" onclick="deleteChat()">
            <span>üóëÔ∏è</span> Delete Chat
        </div>
    </div>

    <!-- Profile Settings Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Profile Settings</h2>
                <button class="modal-close" onclick="closeProfileSettings()">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Avatar Section -->
                <div class="profile-section">
                    <h3>Profile Picture</h3>
                    <div class="profile-avatar-section">
                        <div class="profile-avatar-large" id="profileAvatarLarge">U</div>
                        <div class="avatar-upload">
                            <button class="avatar-upload-btn" onclick="uploadAvatar()">Upload Photo</button>
                            <button class="avatar-upload-btn btn-secondary" onclick="removeAvatar()">Remove</button>
                            <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                        </div>
                    </div>
                </div>

                <!-- Personal Information -->
                <div class="profile-section">
                    <h3>Personal Information</h3>
                    <div class="form-row">
                        <div class="form-field">
                            <label>Display Name</label>
                            <input type="text" id="displayName" placeholder="Your display name">
                        </div>
                        <div class="form-field">
                            <label>Nickname</label>
                            <input type="text" id="nicknameField" placeholder="Your nickname">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label>Email</label>
                            <input type="email" id="emailField" placeholder="your@email.com">
                        </div>
                        <div class="form-field">
                            <label>Phone</label>
                            <input type="tel" id="phoneField" placeholder="+1234567890">
                        </div>
                    </div>
                    <div class="form-field">
                        <label>Bio</label>
                        <textarea id="bioField" placeholder="Tell something about yourself..."></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label>Location</label>
                            <input type="text" id="locationField" placeholder="City, Country">
                        </div>
                        <div class="form-field">
                            <label>Time Zone</label>
                            <select id="timezoneField">
                                <option value="UTC">UTC</option>
                                <option value="US/Eastern">US/Eastern</option>
                                <option value="US/Pacific">US/Pacific</option>
                                <option value="Europe/London">Europe/London</option>
                                <option value="Europe/Kiev">Europe/Kiev</option>
                                <option value="Asia/Tokyo">Asia/Tokyo</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Appearance -->
                <div class="profile-section">
                    <h3>Appearance</h3>
                    <div class="form-field">
                        <label>Theme</label>
                        <div class="theme-options">
                            <div class="theme-option selected" data-theme="light">
                                <div>‚òÄÔ∏è</div>
                                <div>Light</div>
                            </div>
                            <div class="theme-option" data-theme="dark">
                                <div>üåô</div>
                                <div>Dark</div>
                            </div>
                            <div class="theme-option" data-theme="auto">
                                <div>üîÑ</div>
                                <div>Auto</div>
                            </div>
                        </div>
                    </div>
                    <div class="form-field">
                        <label>Accent Color</label>
                        <div class="color-picker">
                            <div class="color-option selected" style="background: #667eea;" data-color="#667eea"></div>
                            <div class="color-option" style="background: #f093fb;" data-color="#f093fb"></div>
                            <div class="color-option" style="background: #4facfe;" data-color="#4facfe"></div>
                            <div class="color-option" style="background: #43e97b;" data-color="#43e97b"></div>
                            <div class="color-option" style="background: #fa709a;" data-color="#fa709a"></div>
                            <div class="color-option" style="background: #ffa726;" data-color="#ffa726"></div>
                        </div>
                    </div>
                </div>

                <!-- Privacy Settings -->
                <div class="profile-section">
                    <h3>Privacy & Security</h3>
                    <div class="privacy-setting">
                        <div>
                            <div>Show online status</div>
                            <small style="color: #65676b;">Let others see when you're online</small>
                        </div>
                        <div class="toggle-switch active" onclick="togglePrivacy(this)">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="privacy-setting">
                        <div>
                            <div>Read receipts</div>
                            <small style="color: #65676b;">Show when you've read messages</small>
                        </div>
                        <div class="toggle-switch active" onclick="togglePrivacy(this)">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="privacy-setting">
                        <div>
                            <div>Allow friend requests</div>
                            <small style="color: #65676b;">Let others send you friend requests</small>
                        </div>
                        <div class="toggle-switch active" onclick="togglePrivacy(this)">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="privacy-setting">
                        <div>
                            <div>Show profile in search</div>
                            <small style="color: #65676b;">Make your profile discoverable</small>
                        </div>
                        <div class="toggle-switch" onclick="togglePrivacy(this)">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                </div>

                <!-- Notifications -->
                <div class="profile-section">
                    <h3>Notifications</h3>
                    <div class="privacy-setting">
                        <div>
                            <div>Message notifications</div>
                            <small style="color: #65676b;">Get notified about new messages</small>
                        </div>
                        <div class="toggle-switch active" onclick="togglePrivacy(this)">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="privacy-setting">
                        <div>
                            <div>Sound notifications</div>
                            <small style="color: #65676b;">Play sound for notifications</small>
                        </div>
                        <div class="toggle-switch active" onclick="togglePrivacy(this)">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                    <div class="privacy-setting">
                        <div>
                            <div>Desktop notifications</div>
                            <small style="color: #65676b;">Show notifications on desktop</small>
                        </div>
                        <div class="toggle-switch" onclick="togglePrivacy(this)">
                            <div class="toggle-slider"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeProfileSettings()">Cancel</button>
                <button class="btn btn-primary" onclick="saveProfileSettings()">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Welcome Modal -->
    <div id="welcomeModal" class="modal welcome-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Welcome to Talk pAI</h2>
            </div>
            <div class="modal-body">
                <div class="welcome-step active">
                    <div class="welcome-icon">üéâ</div>
                    <h3>Welcome to Talk pAI!</h3>
                    <p>Experience the future of messaging with our advanced AI-powered platform. Let's get you started!</p>
                </div>
                <div class="welcome-step">
                    <div class="welcome-icon">ü§ñ</div>
                    <h3>Meet Your AI Assistant</h3>
                    <p>Your personal AI assistant is ready to help with web searches, image analysis, voice conversations, and much more!</p>
                </div>
                <div class="welcome-step">
                    <div class="welcome-icon">üí¨</div>
                    <h3>Advanced Features</h3>
                    <p>Enjoy voice messages, file sharing, image generation, spreadsheet creation, and real-time collaboration tools.</p>
                </div>
                <div class="welcome-step">
                    <div class="welcome-icon">üöÄ</div>
                    <h3>Ready to Start!</h3>
                    <p>You're all set! Start a conversation with the AI Assistant or create your first chat.</p>
                </div>
                <div class="step-indicators">
                    <div class="step-indicator active"></div>
                    <div class="step-indicator"></div>
                    <div class="step-indicator"></div>
                    <div class="step-indicator"></div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="skipWelcome()">Skip</button>
                <button class="btn btn-primary" onclick="nextWelcomeStep()">Next</button>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let currentChat = null;
        let socket = null;
        let authToken = null;
        let isRecording = false;
        let mediaRecorder = null;
        let currentWelcomeStep = 0;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
        });

        function initializeApp() {
            // Check for saved auth token
            const savedToken = localStorage.getItem('authToken');
            if (savedToken) {
                authToken = savedToken;
                hideLoginScreen();
                initializeMessenger();
            }
        }

        function setupEventListeners() {
            // Message input
            const messageInput = document.getElementById('messageInput');
            messageInput.addEventListener('input', function() {
                updateSendButton();
                adjustTextareaHeight(this);
            });

            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });

            // Search input
            document.getElementById('searchInput').addEventListener('input', handleSearch);

            // Theme selection
            document.querySelectorAll('.theme-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectTheme(this.dataset.theme);
                });
            });

            // Color selection
            document.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', function() {
                    selectColor(this.dataset.color);
                });
            });

            // Close dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.chat-menu-btn')) {
                    closeAllChatMenus();
                }
                if (!e.target.closest('.dropdown-menu')) {
                    closeAllDropdowns();
                }
            });
        }

        // Authentication functions
        async function login() {
            const nickname = document.getElementById('loginNickname').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!nickname || !password) {
                alert('Please fill in all fields');
                return;
            }

            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ nickname, password })
                });

                const data = await response.json();

                if (data.success) {
                    authToken = data.user.token;
                    currentUser = data.user;
                    localStorage.setItem('authToken', authToken);
                    hideLoginScreen();
                    initializeMessenger();
                    showWelcomeModal();
                } else {
                    alert(data.error || 'Login failed');
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('Login failed. Please try again.');
            }
        }

        async function register() {
            const nickname = document.getElementById('registerNickname').value.trim();
            const password = document.getElementById('registerPassword').value;

            if (!nickname || !password) {
                alert('Please fill in all fields');
                return;
            }

            if (password.length < 6) {
                alert('Password must be at least 6 characters long');
                return;
            }

            try {
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ nickname, password })
                });

                const data = await response.json();

                if (data.success) {
                    authToken = data.user.token;
                    currentUser = data.user;
                    localStorage.setItem('authToken', authToken);
                    hideLoginScreen();
                    initializeMessenger();
                    showWelcomeModal();
                } else {
                    alert(data.error || 'Registration failed');
                }
            } catch (error) {
                console.error('Registration error:', error);
                alert('Registration failed. Please try again.');
            }
        }

        function logout() {
            localStorage.removeItem('authToken');
            authToken = null;
            currentUser = null;
            currentChat = null;
            if (socket) {
                socket.disconnect();
                socket = null;
            }
            showLoginScreen();
        }

        function showLogin() {
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('registerForm').style.display = 'none';
        }

        function showRegister() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('registerForm').style.display = 'block';
        }

        function hideLoginScreen() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('messengerContainer').style.display = 'flex';
        }

        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('messengerContainer').style.display = 'none';
        }

        // Messenger initialization
        function initializeMessenger() {
            updateUserInfo();
            initializeSocket();
            loadChats();
        }

        function updateUserInfo() {
            if (currentUser) {
                document.getElementById('userName').textContent = currentUser.nickname;
                document.getElementById('userAvatar').textContent = currentUser.nickname.charAt(0).toUpperCase();
                document.getElementById('profileAvatarLarge').textContent = currentUser.nickname.charAt(0).toUpperCase();
                document.getElementById('displayName').value = currentUser.nickname;
                document.getElementById('nicknameField').value = currentUser.nickname;
            }
        }

        function initializeSocket() {
            socket = io();

            socket.on('connect', () => {
                console.log('Connected to server');
            });

            socket.on('new_message', (data) => {
                handleNewMessage(data);
            });

            socket.on('user_typing', (data) => {
                showTypingIndicator(data);
            });

            socket.on('user_stopped_typing', (data) => {
                hideTypingIndicator(data);
            });
        }

        async function loadChats() {
            try {
                const response = await fetch('/api/chat/my-chats', {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const data = await response.json();
                if (data.success) {
                    displayChats(data.chats);
                }
            } catch (error) {
                console.error('Error loading chats:', error);
            }
        }

        function displayChats(chats) {
            const chatList = document.getElementById('chatList');

            // Clear existing chats except AI Assistant
            const aiAssistant = chatList.querySelector('[data-chat-id="ai-assistant"]');
            chatList.innerHTML = '';
            chatList.appendChild(aiAssistant);

            chats.forEach(chat => {
                const chatItem = createChatItem(chat);
                chatList.appendChild(chatItem);
            });
        }

        function createChatItem(chat) {
            const chatItem = document.createElement('div');
            chatItem.className = 'chat-item';
            chatItem.dataset.chatId = chat.id;
            chatItem.onclick = () => selectChat(chat.id);

            chatItem.innerHTML = `
                <div class="chat-avatar">${chat.name ? chat.name.charAt(0).toUpperCase() : 'C'}</div>
                <div class="chat-info">
                    <div class="chat-name">${chat.name || 'Chat'}</div>
                    <div class="chat-preview">${chat.lastMessage || 'No messages yet'}</div>
                </div>
                <div class="chat-meta">
                    <div class="chat-time">${formatTime(chat.updated_at)}</div>
                    ${chat.unreadCount ? `<div class="chat-badge">${chat.unreadCount}</div>` : ''}
                </div>
                <button class="chat-menu-btn" onclick="toggleChatMenu(event, '${chat.id}')">‚ãÆ</button>
            `;

            return chatItem;
        }

        // Chat functions
        function selectChat(chatId) {
            currentChat = chatId;

            // Update UI
            document.querySelectorAll('.chat-item').forEach(item => {
                item.classList.remove('active');
            });

            const selectedItem = document.querySelector(`[data-chat-id="${chatId}"]`);
            if (selectedItem) {
                selectedItem.classList.add('active');
            }

            if (chatId === 'ai-assistant') {
                updateChatHeader('AI Assistant', 'ü§ñ', 'Advanced AI Assistant - Ready to help');
                loadAIAssistantMessages();
            } else {
                loadChatMessages(chatId);
            }

            // Join chat room for real-time updates
            if (socket) {
                socket.emit('join-chat', chatId);
            }
        }

        function updateChatHeader(name, avatar, status) {
            document.getElementById('chatHeaderName').textContent = name;
            document.getElementById('chatHeaderAvatar').textContent = avatar;
            document.getElementById('chatHeaderStatus').textContent = status;
        }

        async function loadChatMessages(chatId) {
            try {
                const response = await fetch(`/api/chat/${chatId}/messages`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const data = await response.json();
                if (data.success) {
                    displayMessages(data.messages);
                }
            } catch (error) {
                console.error('Error loading messages:', error);
            }
        }

        function loadAIAssistantMessages() {
            // Load AI assistant conversation history
            const messages = [
                {
                    id: 'welcome',
                    content: 'Hello! I\'m your AI Assistant. I can help you with:\n\nüåê Web searches and current information\nüëÅÔ∏è Image analysis and recognition\nüé® Image generation\nüìä Spreadsheet creation\nüé§ Voice conversations\nüì± And much more!\n\nHow can I assist you today?',
                    sender_id: 'ai-assistant',
                    created_at: new Date().toISOString(),
                    type: 'ai_response'
                }
            ];
            displayMessages(messages);
        }

        function displayMessages(messages) {
            const container = document.getElementById('messagesContainer');
            container.innerHTML = '';

            messages.forEach(message => {
                const messageElement = createMessageElement(message);
                container.appendChild(messageElement);
            });

            scrollToBottom();
        }

        function createMessageElement(message) {
            const messageDiv = document.createElement('div');
            const isOwn = message.sender_id === currentUser.id;
            const isAI = message.sender_id === 'ai-assistant' || message.type === 'ai_response';

            messageDiv.className = `message ${isOwn ? 'sent' : 'received'}`;

            let avatar = '';
            if (!isOwn) {
                if (isAI) {
                    avatar = `<div class="message-avatar ai-assistant-avatar">ü§ñ</div>`;
                } else {
                    avatar = `<div class="message-avatar">${message.sender_name ? message.sender_name.charAt(0).toUpperCase() : 'U'}</div>`;
                }
            } else {
                avatar = `<div class="message-avatar">${currentUser.nickname.charAt(0).toUpperCase()}</div>`;
            }

            messageDiv.innerHTML = `
                ${avatar}
                <div class="message-content">
                    <div class="message-text">${formatMessageContent(message.content)}</div>
                    <div class="message-time">${formatTime(message.created_at)}</div>
                </div>
            `;

            return messageDiv;
        }

        function formatMessageContent(content) {
            // Basic formatting for message content
            return content.replace(/\n/g, '<br>');
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();

            if (!message || !currentChat) return;

            // Clear input
            input.value = '';
            updateSendButton();
            adjustTextareaHeight(input);

            if (currentChat === 'ai-assistant') {
                await sendAIMessage(message);
            } else {
                await sendRegularMessage(currentChat, message);
            }
        }

        async function sendAIMessage(message) {
            // Add user message to UI immediately
            addMessageToUI({
                content: message,
                sender_id: currentUser.id,
                created_at: new Date().toISOString()
            });

            // Show typing indicator
            showAITyping();

            try {
                const response = await fetch('/api/aiden/enhanced-chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ message })
                });

                const data = await response.json();
                hideAITyping();

                if (data.success) {
                    addMessageToUI({
                        content: data.aiden.message,
                        sender_id: 'ai-assistant',
                        created_at: data.timestamp,
                        type: 'ai_response'
                    });
                } else {
                    addMessageToUI({
                        content: 'Sorry, I encountered an error. Please try again.',
                        sender_id: 'ai-assistant',
                        created_at: new Date().toISOString(),
                        type: 'ai_response'
                    });
                }
            } catch (error) {
                console.error('AI message error:', error);
                hideAITyping();
                addMessageToUI({
                    content: 'Sorry, I\'m currently unavailable. Please try again later.',
                    sender_id: 'ai-assistant',
                    created_at: new Date().toISOString(),
                    type: 'ai_response'
                });
            }
        }

        async function sendRegularMessage(chatId, message) {
            try {
                const response = await fetch(`/api/chat/${chatId}/messages`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ content: message })
                });

                const data = await response.json();
                if (data.success) {
                    addMessageToUI(data.message);
                }
            } catch (error) {
                console.error('Send message error:', error);
            }
        }

        function addMessageToUI(message) {
            const container = document.getElementById('messagesContainer');
            const messageElement = createMessageElement(message);
            container.appendChild(messageElement);
            scrollToBottom();
        }

        function showAITyping() {
            const container = document.getElementById('messagesContainer');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'ai-typing';
            typingDiv.className = 'message received';
            typingDiv.innerHTML = `
                <div class="message-avatar ai-assistant-avatar">ü§ñ</div>
                <div class="message-content">
                    <div class="message-text">
                        <div class="voice-wave">
                            <span></span>
                            <span></span>
                            <span></span>
                            <span></span>
                        </div>
                        AI Assistant is thinking...
                    </div>
                </div>
            `;
            container.appendChild(typingDiv);
            scrollToBottom();
        }

        function hideAITyping() {
            const typingElement = document.getElementById('ai-typing');
            if (typingElement) {
                typingElement.remove();
            }
        }

        // Chat menu functions
        function toggleChatMenu(event, chatId) {
            event.stopPropagation();
            const menu = document.getElementById('chatMenu');
            const rect = event.target.getBoundingClientRect();

            menu.style.top = rect.bottom + 'px';
            menu.style.right = (window.innerWidth - rect.right) + 'px';
            menu.classList.toggle('show');
            menu.dataset.chatId = chatId;
        }

        function closeAllChatMenus() {
            document.querySelectorAll('.chat-menu').forEach(menu => {
                menu.classList.remove('show');
            });
        }

        function closeAllDropdowns() {
            document.querySelectorAll('.dropdown-menu').forEach(dropdown => {
                dropdown.classList.remove('show');
            });
        }

        function pinChat() {
            const chatId = document.getElementById('chatMenu').dataset.chatId;
            console.log('Pin chat:', chatId);
            closeAllChatMenus();
        }

        function muteChat() {
            const chatId = document.getElementById('chatMenu').dataset.chatId;
            console.log('Mute chat:', chatId);
            closeAllChatMenus();
        }

        function archiveChat() {
            const chatId = document.getElementById('chatMenu').dataset.chatId;
            console.log('Archive chat:', chatId);
            closeAllChatMenus();
        }

        function markAsUnread() {
            const chatId = document.getElementById('chatMenu').dataset.chatId;
            console.log('Mark as unread:', chatId);
            closeAllChatMenus();
        }

        function exportChat() {
            const chatId = document.getElementById('chatMenu').dataset.chatId;
            console.log('Export chat:', chatId);
            closeAllChatMenus();
        }

        function deleteChat() {
            const chatId = document.getElementById('chatMenu').dataset.chatId;
            if (confirm('Are you sure you want to delete this chat?')) {
                console.log('Delete chat:', chatId);
            }
            closeAllChatMenus();
        }

        // Profile settings
        function openProfileSettings() {
            document.getElementById('profileModal').classList.add('show');
        }

        function closeProfileSettings() {
            document.getElementById('profileModal').classList.remove('show');
        }

        function saveProfileSettings() {
            // Collect form data
            const profileData = {
                displayName: document.getElementById('displayName').value,
                email: document.getElementById('emailField').value,
                phone: document.getElementById('phoneField').value,
                bio: document.getElementById('bioField').value,
                location: document.getElementById('locationField').value,
                timezone: document.getElementById('timezoneField').value
            };

            console.log('Saving profile:', profileData);
            closeProfileSettings();
        }

        function selectTheme(theme) {
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.classList.add('selected');

            // Apply theme
            document.body.dataset.theme = theme;
        }

        function selectColor(color) {
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.target.classList.add('selected');

            // Apply color
            document.documentElement.style.setProperty('--accent-color', color);
        }

        function togglePrivacy(toggle) {
            toggle.classList.toggle('active');
        }

        function uploadAvatar() {
            document.getElementById('avatarInput').click();
        }

        function removeAvatar() {
            console.log('Remove avatar');
        }

        // Welcome modal
        function showWelcomeModal() {
            document.getElementById('welcomeModal').classList.add('show');
        }

        function nextWelcomeStep() {
            const steps = document.querySelectorAll('.welcome-step');
            const indicators = document.querySelectorAll('.step-indicator');

            if (currentWelcomeStep < steps.length - 1) {
                steps[currentWelcomeStep].classList.remove('active');
                indicators[currentWelcomeStep].classList.remove('active');

                currentWelcomeStep++;

                steps[currentWelcomeStep].classList.add('active');
                indicators[currentWelcomeStep].classList.add('active');

                if (currentWelcomeStep === steps.length - 1) {
                    document.querySelector('.modal-actions .btn-primary').textContent = 'Get Started';
                }
            } else {
                finishWelcome();
            }
        }

        function skipWelcome() {
            finishWelcome();
        }

        function finishWelcome() {
            document.getElementById('welcomeModal').classList.remove('show');
            selectChat('ai-assistant');
        }

        // Utility functions
        function updateSendButton() {
            const input = document.getElementById('messageInput');
            const sendBtn = document.getElementById('sendBtn');
            sendBtn.disabled = !input.value.trim();
        }

        function adjustTextareaHeight(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 100) + 'px';
        }

        function scrollToBottom() {
            const container = document.getElementById('messagesContainer');
            container.scrollTop = container.scrollHeight;
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;

            if (diff < 60000) { // Less than 1 minute
                return 'now';
            } else if (diff < 3600000) { // Less than 1 hour
                return Math.floor(diff / 60000) + 'm';
            } else if (diff < 86400000) { // Less than 1 day
                return Math.floor(diff / 3600000) + 'h';
            } else {
                return date.toLocaleDateString();
            }
        }

        function handleSearch() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const chatItems = document.querySelectorAll('.chat-item');

            chatItems.forEach(item => {
                const name = item.querySelector('.chat-name').textContent.toLowerCase();
                const preview = item.querySelector('.chat-preview').textContent.toLowerCase();

                if (name.includes(query) || preview.includes(query)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        }

        // Advanced features placeholders
        function toggleEmojiPicker() {
            console.log('Toggle emoji picker');
        }

        function openFileUpload() {
            console.log('Open file upload');
        }

        function toggleVoiceRecording() {
            console.log('Toggle voice recording');
        }

        function openImageGenerator() {
            console.log('Open image generator');
        }

        function openSpreadsheetGenerator() {
            console.log('Open spreadsheet generator');
        }

        function startVoiceCall() {
            console.log('Start voice call');
        }

        function startVideoCall() {
            console.log('Start video call');
        }

        function openChatInfo() {
            console.log('Open chat info');
        }

        function toggleChatOptions() {
            console.log('Toggle chat options');
        }

        function openSettings() {
            openProfileSettings();
        }

        // Handle new messages from socket
        function handleNewMessage(data) {
            if (data.chatId === currentChat) {
                addMessageToUI(data.message);
            }
        }

        function showTypingIndicator(data) {
            // Implementation for typing indicator
        }

        function hideTypingIndicator(data) {
            // Implementation for hiding typing indicator
        }
    </script>
</body>
</html>